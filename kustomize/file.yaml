apiVersion: v1
data:
  EVENT_BRIDGE_DB_HOST: event-bridge-db
  EVENT_BRIDGE_DB_PASSWORD: postgres
  EVENT_BRIDGE_DB_PORT: "5432"
  EVENT_BRIDGE_DB_SCHEMA: event-bridge
  EVENT_BRIDGE_DB_USERNAME: postgres
  EVENT_BRIDGE_MANAGER_URL: http://event-bridge:8080
kind: ConfigMap
metadata:
  labels:
    app: event-bridge
  name: event-bridge-all-in-one-config
  namespace: event-bridge-prod
---
apiVersion: v1
data:
  PGDATA: /var/lib/postgresql/data/pgdata
  POSTGRES_DB: event-bridge
  POSTGRES_PASSWORD: postgres
  POSTGRES_USER: postgres
kind: ConfigMap
metadata:
  labels:
    app: event-bridge
  name: event-bridge-db-config
  namespace: event-bridge-prod
---
apiVersion: v1
kind: Service
metadata:
  labels:
    app: event-bridge
  name: event-bridge
  namespace: event-bridge-prod
spec:
  ports:
  - name: web
    port: 8080
    protocol: TCP
    targetPort: 8080
  selector:
    app: event-bridge
---
apiVersion: v1
kind: Service
metadata:
  labels:
    app: event-bridge
  name: event-bridge-db
  namespace: event-bridge-prod
spec:
  ports:
  - name: mytcp
    port: 5432
    protocol: TCP
  selector:
    app: event-bridge
---
apiVersion: apps/v1
kind: Deployment
metadata:
  labels:
    app: event-bridge
  name: event-bridge
  namespace: event-bridge-prod
spec:
  replicas: 1
  selector:
    matchLabels:
      app: event-bridge
  template:
    metadata:
      labels:
        app: event-bridge
    spec:
      containers:
      - envFrom:
        - configMapRef:
            name: event-bridge-all-in-one-config
        - secretRef:
            name: kafka-secrets
        image: quay.io/jrota/event-bridge-all-in-one:1.2
        imagePullPolicy: IfNotPresent
        name: event-bridge-all-in-one
        ports:
        - containerPort: 8080
---
apiVersion: apps/v1
kind: Deployment
metadata:
  labels:
    app: event-bridge
  name: event-bridge-db
  namespace: event-bridge-prod
spec:
  replicas: 1
  selector:
    matchLabels:
      app: event-bridge
  strategy:
    type: Recreate
  template:
    metadata:
      labels:
        app: event-bridge
    spec:
      containers:
      - envFrom:
        - configMapRef:
            name: event-bridge-db-config
        image: library/postgres:13.1
        imagePullPolicy: IfNotPresent
        name: postgres
        ports:
        - containerPort: 5432
        volumeMounts:
        - mountPath: /var/lib/postgresql/data
          name: event-bridge-db
      volumes:
      - name: event-bridge-db
        persistentVolumeClaim:
          claimName: event-bridge-db
---
apiVersion: bitnami.com/v1alpha1
kind: SealedSecret
metadata:
  annotations:
    sealedsecrets.bitnami.com/cluster-wide: "true"
  creationTimestamp: null
  name: kafka-secrets
  namespace: event-bridge-prod
spec:
  encryptedData:
    KAFKA_BOOTSTRAP_SERVERS: AgBdTPopaJ4pLj8tJH568uMi88pMVRo+A0wy5+JpWnGYUvledP0AaUFtl4eI9jZY1LqQRpebcLFTV5b/OoLFDaPMLYfB2ix3FBQOM6TsiBFhgOxjOrD4ucbjD1t2JMFEGT+lVXfVSLZsAgKFTK40nGIFa63nXWgzWxicVO6JCbWmVX25nlXnJjRNuPaMSFAtJBV7WqoEjHjb0fEWqoN5sUw0Lk1bmVoF2hOPQwYlUwZjKdss8tvvxYGX/0kJDHPna/3zhSPBFQ3HvJiwkZru/e9X3Ha87/BAQrOXDzS+TosZf+nHF9KTY3POCygtzfy/t88Pja1yzvdUjvLmvAQYfEJ57AtlGe3VAJPHyyholn1yCjyE4vzOu5EZC96OSQSPP805PPXZu++P4BtAMTdo6EkDVe29vxLS7AtMNaYWusgOHSFSkryWTTKkJKPiHa6QUHiMfg7G/0AYpUij8mUZWTgONaYGEyRM0CfD7vTG2oeGE+qXboxMKrhOD4xYPn960/BW3xIxwGAJGgbk64viMTB9q9eixhqpm4WOYWvlpZmWZnD0Tnf2uaxhJ6YdTNhVNyC2I2+kki0KcMhFBKHROQXKQnU4jAUn4dNsrznGRuq93Qx0kUo6Z4BGGfVnqdrAbJgZdpb2sSkReMlG5F6fsGdkSWQs06DO9064pg+h6RYikNLJYtjVAjQ6UkZMTCUbzm6XoYVq8sAO9O7VW4jXQZR9uZIOV1EaEhMSVsQvoOFFoOlbldYWmqx3HQfQe/tEfL+Z0wjhAq8PJuJPD+7TXcsASA==
    KAFKA_CLIENT_ID: AgAl4JlvXOsSkTMM+6epJok/vE+rvkl7RZTlA5Q+0OMZuotHTIT1U99QsECHYQPy58c7OF28RQOK0lwcuwCpCTOcOF1jGoWiy/a/apaGa2PNjFxdyj7KlB4cc90/eFGF1oblLcF6DV+5gZfT8D8cmIqkbQDJT7YE+CtkI5YO3MsXCHDdaik3Hj3SEOgS9jwzWsO68Kn5DKEpZ6ndGhoXr6EgeXspAZVAmXC6L4eTz2JcjOMP0/wp/YOWZXAE8Ch+gGJJIU2AsTe9IiLdU0Suw3jZzl5skF8yK2paB5g1vrQkjMQxyXXXi98NfkoL39hrMzP+imOkz3Ts5XTHO/+HQFlJwLDJGJ+fUV6P78TrLTrTxIwuFn+P5hoWsgfS0if7LDAdZd3WNu6l9A9Q77AhO77Itd/R9StYdIVyqvfY8VjUtxbJeyAuxj/jfiO7SRqbyqFcu+9mDe8dPCXSNt05mE/rSJ2x3GeVfL8K3KRswoVLCurjWJy7uQUSuV6iIKeoz+N9q6k+HknJH3uWTWSimDVwWrSeMY/f8OKzPnlBcQW8B8Ah1LbQC3yzqR62Hz0OfDnTVh4uiwUCma+zbxMHkiNQe7VjP2Obc0RZlo9IbPErRSt4YDBYSSSty8roRwbVtcrQ02gCJHTYnzb0EVAd2jmicSvezazmVCEaeyk8M/AiJYBBpU0wDRmtmQjG2nuOC4+Om7HMMnE/0CJAO5DZlC9H8eLxyKn6mteOkE1DphKNBW+Oe0VHk+auV8PTZUPR
    KAFKA_CLIENT_SECRET: AgBRWdu0BRUctEqQnesg4EGTMs3acxPanhfV6svGR9w4iuuzyvS+Ai366nnZRvcbQgG7qLSedP5D5/0P29PU+8Seg4Zs20WkyUPbqJrj43MH/ZxkdvkyEsFkB25YhO+yANZSGoMCbSrWaectIOuX1nmqZDhJZ5bD6NCq+BG2Q6AHSL0PGHBFPYXHxmaIRO7QNexOE4PVgP9g7CiuqzvmpeFpNXYoA+8XeL/fp2b0cn4FvNsPTT81HYDDfUqEJIsh+bPz8yEBcYApmHx1WEXN72hSQh5/iV4aXKYA5QxAY3Yn3yjshqyw24AS40o5NdEbOi3b88wuWIpQBKIEjtgjN0+H+Lx57VPLhyCdAmWJB2N2lI8lV1JknoGxTErZ+hdzJqpPhhw5xaNJPSiepnQwMFWFe9Wq6rjUOA5RopIalI9U8/dKi6LodGx/+LIz/JnlMKd+iCYCfi3KwzNihu0+apJ6XawTddhsXkHJNQCJ8Iv1MMbFLnLQGzTQjv/sHXwc0ydxjT4uJwMzZ8SM4vbOZnz/KsxRhqa7YrKyxt7kJAGaUAu3sNMQuMrHLpA8/eWm+hVX/U+9Jjez242HUMQrbk1k7Mg7u4D99kJKdLLMu1B9EtUemHWIqDAgxzo8CaLq3NRwOV+wi9PN9te6Za5nPI7FtDXMaHD9do2kjmtn6jokXk8lJLXfrLCtht4DN2aJYnJ0ix+9GpqqWqr7TBfjW4mgDgOgq0u1vFjcl9erZfyy3ckIZj4=
  template:
    metadata:
      annotations:
        sealedsecrets.bitnami.com/cluster-wide: "true"
      creationTimestamp: null
      name: kafka-secrets
---
apiVersion: route.openshift.io/v1
kind: Route
metadata:
  annotations:
    haproxy.router.openshift.io/disable_cookies: "true"
  name: event-bridge
  namespace: event-bridge-prod
spec:
  port:
    targetPort: 8080
  tls:
    insecureEdgeTerminationPolicy: Redirect
    termination: edge
  to:
    kind: Service
    name: event-bridge
---
apiVersion: v1
kind: PersistentVolumeClaim
metadata:
  labels:
    app: event-bridge
  name: event-bridge-db
  namespace: event-bridge-prod
spec:
  accessModes:
  - ReadWriteOnce
  resources:
    requests:
      storage: 10Gi
